# overview
1. Understand the computer network protocol stack
2. Understand various network addresses: MAC, IP, port number
3. Assign and route with network addresses
4. Understand basic network services such as: ICMP, ARP, DHCP, DNS


# Unit1
## 一個簡單的例子
1. 發送郵件
    1. 將電子郵件封裝在IP數據包中發送
    2. 將郵件地址URL 轉換成IP 地址和TCP 端口號
        1. TCP 端口號
        2. IP 主機地址
        3. IP 地址前綴
    3. 互聯網路路由器只查看IP 地址前綴傳送數據包
    4. 本地網路路由器由IP 主機地址傳送到目標主機
2. 安全問題在網路環境中尤其重要
## 網路的結構, 基礎設施
1. 終端: 網路由兩台以上終端組成
    1. 實體主機: 客戶端, 服務器
    2. 虛擬機
    3. 容器
2. 分層結構
    1. 物理層網路: 終端, 交換機, 路由器的實際連接
    2. 邏輯, 虛擬網路:
        1. 數據連接層: 視一台交換機連接的終端為一個網路
        2. 網路層: 視一台路由器作為一個網路
        3. 應用層: 視一個終端內的APP 和合此APP 連接的終端為一個網路
    3. OSI模型: 7層
        1. 應用程序: APP
        2. 表示: APP
        3. 會話: APP session
        4. 傳輸: gateway(類似於router的作用), moden(數位轉類比方便傳輸), 專有網路和互聯網的分界:TCP/UDP port
        5. 網路: router(轉發數據倒下個節點): 根據IP 地址轉發
        6. 數據鏈路: switch(接收或傳遞到單一設備), bridge(類似於switch): 根據MAC 地址轉發
        7. 物理層: hub(網路廣播), bridge(放大信號): 只做傳輸訊號, 不會改變內容
    4. network stack: 4層
        1. 應用程序: 包含1, 2, 3
        2. TCP/UDP: 傳輸
        3. IP互聯網協議: 網路
        4. 網路接口: 包含6, 7
    5. 細腰結構
        1. 網路接口層有許多不同協議
        2. 網路層主要使用IPv4, IPv6
        3. 傳輸層主要使用TCP, UDP
        4. 應用程序層也有許多不同協議
3. 包裝
    1. 在數據上層層包裝訊息以進行傳輸, 到另一端再拆包
    2. 每一層不相互影響


# Unit2
## MAC 地址
1. 48bits, 6bytes, 12個16進制數字
2. 於本地網路使用
3. 由交換機使用
    1. 數據包含源MAC 地址和目的MAC 地址
    2. 交換機經由查表找到對應的交換機輸出端口, 或是無線網路頻段
    3. 交換機將數據由特定端口輸出到主機

## IP 地址
1. 初期網路IPv4 地址: 有分類的IP 地址
    1. 總長32bits, 切分成網路號和主機號
    2. 分成ABCDE類, 相互不重疊
    3. A類開頭為0, 1byte 為網路號, 後3bytes 為主機號, 第一bytes為0到127
    4. B類開頭為10, 2bytes 為網路號(), 後2bytes 為主機號, 第一bytes為128到191
    5. C類開頭為110, 3bytes 為網路號(), 後1byte 為主機號, 第一bytes為192到223
    6. D類開頭為1110, 少用
    7. E類開頭為11110, 少用
    8. 主機號全為0代表此網路, 通常部會分配給主機, 全為1代表廣播, 會發送給此網路號底下所有主機
2.  IPv4 預留私有網路位置
    1. 10.0.0.0/8 (10.0.0.0到10.255.255.255)
    2. 172.16.0.0/12(172.16.0.0到172.31.255.255)
    3. 192.168.0.0/16(192.168.0.0到192.168.255.255)
    4. 此處的/8代表前8位為掩碼
3. 子網路
    1. 子網路是把一個類型的網路號底下的主機號切分給網路號, 使得IP 位置有更好的利用
    2. 一開始掩碼長度和類型網路號相當, 和IP 作與運算後, 只保留網路號, 而主機號會被隱藏
        1. 例如A類預設掩碼255.0.0.0, 和A類IP地址作與計算後只會剩下前1byte, 即為A類網路的網路號
    3. 後來為有效利用IP 地址, 引入VLSM可變長度子網掩碼
        1. 得到某類IP地址後, 可以多保留幾位作為子網劃分
        2. 例如一個B類網址130.100.0.0/16, 但你不需要劃分2^16-2台主機
        3. 可以藉由路由切分成 130.100.32.0/19, 130.100.64.0/19等等, 後面2^13位才為主機位
    4. 優點
        1. 有效分配IP
        2. 一個網路(路由器)底下主機數目減少, 加速網路
        3. 易於組織和安全性
    5. 缺點: 更為複雜而且難更動
4. CIDR無類別域間路由
    1. 不再考慮網路分類
    2. 掩碼不再只向下切分子網, 也可以向上組成超網(大部分仍稱為子網)
    3. 例如原本C類掩碼/24, CIDR可以使用掩碼/20, 等於是16個c類組成的網路

## 端口號
1. 主機和應用程式間的轉換
    1. Web服務器預設是80, 當你的客戶端瀏覽器要到伺服器的web應用, 會要到伺服器的80端口
    2. 通常瀏覽器端口號就不夠定, 因為只要數據有正確的源端口可以讓伺服器回傳即可
2. 應用會向OS要求端口號, OS會指派並紀錄, 一個端可只能有一個應用監聽
3. 一個端口可以使用TDP或是UDP
    1. TCP
        1. TCP報頭較長, 接收方會要在接收封包後回傳給傳送方
        2. 傳送方可以根據收到的數據決定需不需要再傳送一次數據
        3. 作為可靠的多封包數據傳輸
    2. UDP
        1. UDP只有可選的教驗和, 確定此封包數據正確性
4. 端口號和IP組成應用的標示
    1. 例如"8.8.8.8:53", 會傳送到google某伺服器的DNS應用
5. 端口號有16bits, 0到65535
    1. 有一個由IANA維護的端口號列表
        1. 0到1023是知名端口: 常見應用的端口, 例如web應用端口80
        2. 1024到49151是註冊端口: 多是服務器使用
        3. 49152到65535式動態端口, 臨時端口: 多是客戶端使用


# Unit3
## 網路路由
1. 路由器會查詢內部的路由表, 經由IP來尋找下一個MAC地址, 把封包傳送到下一個主機或路由器
    1. 其實MAC地址原本是由switch 處理, 但現今路由器多會包含switch
    2. 屬於2+3層
2. gateway網關
    1. 網路連接到另一個網路的邊界
    2. 也可能用作連接不同的系統或協議
    3. 代理也是網關的一種
    4. 可以是虛擬的
    5. 最高可以到第7層
3. Linux查詢路由
    1. 輸入"route -n"
    2. 現在有一個封包要送出, 主機會由掩碼最長, 列表從上倒下尋找對應端口
    3. 第一個通常是默認網關, 掩碼0.0.0.0, 也就是在其他端口都沒有對應時會使用此端口轉發給默認網關
    4. 可以更改默認網關


# Unit4
## ICMP
1. ping 和traceroute 使用的協議
2. 主要作用是報告錯誤和執行網路診斷
3. 運作在L3, 使用IP, 目前到第4版
4. 通常會使用以下報文
    1. 回聲請求(ICMP 類型8)
    2. 回聲答覆(ICMP 類型0)
    3. 超時
    4. 目的不可達
    5. 改變方向
5. ICMP 回聲報文
    1. 最常實現是使用ping指令
    2. "ping ip" 指名要求回聲的主機
    3. "ping -c count" 指名要求回聲的次數
6. ICMP 超時報文
    1. Time to Live(TTL)
    2. 參數不是時間, 是經過幾台router
    3. 如果經過x 台路由器還沒有到達目標ip 主機, 最後到達的路由器會回傳超時報文
7. ICMP 目的不可達報文
    1. 共有六種場景/報頭
        1. 0: 網路不可達
        2. 1: 主機不可達
        3. 2: 協議不可達
        4. 3: 端口不可達
        5. 4: 需要碎片和DF 集
        6. 5: 源路由失敗
8. ICMP 改變方向
    1. 路由器可以回傳報文改變主機路由表

## ARP
1. Address Resolve Protocol地址解析協議
2. 是作用於L2, 使用MAC, 可以將IP 轉換成MAC, 由MAC 轉換成IP 需要使用RARP
3. ARP會廣播請求區域網路內所有主機, 相應IP 的主機會回覆MAC 給源主機
4. 主機會緩存一個ARP表, 內容為IP, 對應MAC和端口
5. 一開始APR表可以為空, 應為可以直交靠廣播取得第一條MAC對應

## DHCP
1. 動態主機配置協議: 動態分配IP地址
2. 使用UDP協議傳輸
3. 除提供IP外, 也可以配置路由表和DNS地址
4. 詳細報文參考影片8:18位置
5. 常用報文
    1. DHCPDISCOVER: 用廣播尋找DHCP 伺服器
    2. DHCPOFFER: DHCP 伺服器回覆客戶端要求, 客戶端會以第一台回覆的主機作為DHCP 伺服器
    3. DHCPREQUEST: 客戶端向伺服器要求IP, 要進行時限更新也是使用此報文
    4. DHCPRESPONSE: 伺服器以IP 地址回覆客戶端要求
    5. DHCPRELEASE: 客戶端使用完畢, 告知伺服器以釋放IP 給其他主機使用

## DNS
1. Dynamic Name Service動態域名服務
2. 可交互轉換IP 和 URL
3. 使用端口53, 多使用UDP, 也可以使用TCP
4. 主機端也有可以有IP 和URL 對應表, 表上URL 就無需尋找DNS 來取得IP
5. DNS域名空間分層: URL由後往前解析
    1. 根域名服務器: 有所有一級域名服務器位置
    2. 一級域名服務器
        1. 通用頂級域名: 例如com, gov
        2. 國家代碼: 例如jp, cn
6. 主機通常不會直接向各個服務器查詢IP, 會交由ISP 的服務器去和其他服務器查詢
    1. ISP 的服務器會快取常用的IP 和URL對應, 以便下次不用一個一個域名解析